# ストレージ

## S3/Glacier

## EBS

## EFS

* EC2・Lambdaなど複数のクライアントから同時アクセスが可能なファイルストレージサービス
* クライアントからのEFSへの接続は、一般的なNFS（NFSv4プロトコル。POSIX準拠）をサポートしているため、NFSクライアントさえあれば特別なツールやライブラリは不要
* EFSのマウント先としてAWSおよびオンプレのリソースで使用可能
  + https://docs.aws.amazon.com/ja_jp/efs/latest/ug/how-it-works.html
* WindowsベースのクライアントではeFSは使用できない。
  ただし、代替サービスとしてAmazon FSx for Windows File Serverが利用できる（FSxはNTFSファイルシステム）

## FSx

## Storage Gateway
出展： https://aws.amazon.com/jp/storagegateway/
![](https://d1.awsstatic.com/pdp-how-it-works-assets/product-page-diagram_AWS-Storage-Gateway_HIW@2x.6df96d96cdbaa61ed3ce935262431aabcfb9e52d.png)

* オンプレミスにあるデータをクラウドへ連携するための受け口を提供するサービス
* データの保存先は、S3やS3 Glacierといった耐久性が高く低コストなストレージを利用
* キャッシュストレージとしてはEBSを利用
* オンプレミス・AWSのどちら側にも配置が可能
  + オンプレミス向けにはVMwareやHyper-Vで利用できるイメージを提供。
    これらのハイパーバイザー環境があればかんたんに導入可能
  + AWS向けにはEC2インスタンスのStorage Gateway様AMIを用意

### ゲートウェイタイプ
ファイルゲートウェイ・ボリュームゲートウェイ・テープゲートウェイが用意されている
* ファイルゲートウェイ・キャッシュ型ボリュームゲートウェイは、参照度の高いデータは「ファイルキャッシュ」として、オンプレのキャッシュボリュームに配置する
* 一方、保管型ボリュームゲートウェイは、プライマリのデータの保存場所はオンプレ側であり、S3はスナップショットの置き場所と、S3の意味合いが異なる

| タイプ | | 配置先 | S3での保存単位 | S3への保存タイミング | プライマリデータの保存場所 | ファイルキャッシュ | クライアントIF | S3 APIからのアクセス |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| ファイル | | オンプレ,EC2 | ファイル | 非同期ほぼリアルタイム | S3 | あり（一部） | NFSv3,v4.1 | 可 |
| ボリューム | キャッシュ型 | オンプレ,EC2 | ボリューム | 非同期スナップショット | S3 | あり（一部） | iSCSI | 不可 |
| | 保管型 | オンプレ | ボリューム | 非同期スナップショット | ローカルディスク | あり（全部） | iSCSI | 不可 |
| テープ | | オンプレ,EC2 | 仮想テープ | 非同期バックアップ | ローカルディスク | なし | iSCSI | 不可 |


# コンピューティング

## Auto Scaling
* システムの利用状況（設定した閾値やヘルスチェックの結果）によって、インスタンスの台数を自動的に増減させるサービス
* ただし、閾値を超えたにも関わらずスケーリングが上手く実行されずに24h以上経過した場合、自動的にAuto Scalingが停止するようになっている
  > 詳細は https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/as-suspend-resume-processes.html

### スケーリングポリシー
https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/scaling_plan.html

| ポリシー | | 内容 |
| --- | --- | --- |
| 動的スケーリング | 簡易スケーリング | １つのメトリクスに対して１つの閾値を設定。現在は非推奨 |
| | ステップスケーリング | １つのメトリクスに対して１つ以のの閾値を設定し、段階ごとのスケーリング設定が可能。簡易スケーリングの上位互換 |
| | ターゲット追跡スケーリング | １つのメトリクスに対して目標値を設定し、Auto Scalingグループがその目標値を維持するように自動的に調整。今後の主流になると思われる |
| 手動スケーリング | | 希望する容量を手動で調整。いつでも実施可能 |
| 予測スケーリング | | 機械学習を使用して CloudWatch からの履歴データに基づいてキャパシティー要件を予測 |
| スケジュールスケーリング | | 予想可能なロードの変化に応じて独自のスケーリングスケジュールを設定 |


### 設計ポイント
* インスタンス（サーバ）をステートレスに設計する
* AZをまたがってインスタンスを配置するように設計する
  - 例) インスタンスが1台故障しても100%の稼働状態を実現するには？
    + 3つのAZにまたがってAuto Scaling
    + ピークロードを50%処理できるよう設定
    + => 1台故障してもピークロード50%x2台=（机上では）稼働率100%を維持

---
## ECS
### 起動モード
EC2とFargateから選択可能

* EC2
  - コンテナインスタンスとしてEC2インスタンスを起動。
    そのため、サービスアプリを実行するインフラに対して詳細なコントロールが可能
  - タスクスケジュールにより、コンテナインスタンスのコンテナ配置をスケジュール可能（Fargateも同様）
* Fargate
  - コンテナインスタンスの管理が不要
  - CPU・メモリなどのアプリ要件を定義すると、必要なスケーリングやインフラはFargateで管理
  - 秒単位で数万個のコンテナを起動可能


# プロビジョニング/デプロイ
## 各サービスの比較

| | Elastic Beanstalk | OpsWorks | CloudFromation | ECS |
| --- | --- | --- | --- | --- |
| アプリケーションのデプロイ | ○[※1] | △[※3] | - | ○ |
| Docker対応 | ○[※2] | - | - | ○ |
| プロビジョニング | ○ | ○ | ○ | - |
| 環境単位での設定変更 | ○ | ○ | △[※5] | - |
| オープンソース活用 | - | ○[※4] | - | - |

* [※1] アプリケーションのzip展開からECSと組み合わせてDockerコンテナの展開までサポート
* [※2] ※1の通り
* [※3] EC2インスタンスで稼働するOpsWorksエージェントがChefレシピを展開してアプリケーションをダウンロードすることで可能
* [※4] Chef/Puppetを活用。ただし廃れつつあるが…
* [※5] 例えばテンプレートのParametersで変更できるが、それの変更を促す何がが別途必要（例えばAnsible）

参考リンク
* https://dev.classmethod.jp/articles/awssummit-tokyo-2015-ta-05/
* 

### ユースケース
機能が重複しており、完全にこの通りに分けられるわけではない点に注意

* Elastic Banstalk
  * 定番構築であれば、プロビジョニングからアプリケーションのデプロイまですべて可能
  * ローリングデプロイをサポート
* OpsWorks
  * アプリケーションもデプロイできるが、
    どちらかというとサーバの構成管理・運用自動化寄りなイメージ
  * Chef/Puppetのオープンソース活用
  * 開発/テスト/本番でインフラ設定の変更が可能
* CloudFormation
  * AWSリソースの構築の効率化
  * 開発/テスト/本番で利用するインフラの標準化  
  * アプリケーションのデプロイは、何か他のツール/サービスとの組み合わせが必須

## Elastic Beanstalk
* ウェブアプリケーションの構成管理サービス
* ECSなどのDockerサービスと連携することで、Dokcerからウェブアプリケーションをデプロイすることもできる
* 構築できる構成は大きくは以下の2つ
  1. Webサーバ構成： ELB--EC2+AutoScaling
  2. ワーカー構成： SQS--EC2+Auto Scaling
* 自動バッチ適用、キャパシティのプロビジョニング、負荷分散、Auto Scaling、アプリケーションのヘルスモニタリング、などのデプロイタスクを自動化する

> 1日1回程度のバッチ処理であれば、ELastic BenastalkではなくAWS Batchで構成する選択肢もある

## OpsWorks
* **Chef/Puppet**を利用したインフラ構成管理サービス
* スタック・レイヤーの概念が存在
  - スタック
    + OpsWorksのトップエンティティ
    + スタック単位こ構成情報をJSON形式で保持する。スタックの下に複数のレイヤーを定義できる
  - レイヤー
    + スタックのコンポーネントを定義
    + レイヤーに対してChefのレシピをマッピングすることで詳細な設定が可能

## CloudFormation
* AWSリソースを自動構築するためのサービス
* チェンジセット
  * スタックの更新を行う時のサマリー
* ドリフト
  * テンプレートによって展開したAWSリソースを、展開後に変更した場合、
    元テンプレートとの差分を検出するチェック機能
* スタックセット
  * CloudFromationテンプレート内にAWSリソースの設定を定義して、
    1つのテンプレートにより複数のアカウントやリージョンにリソースを展開できる

## SAM（Simple Application Model）

# AWS認定資格テキスト AWS認定クラウドプラクティショナー
* https://www.amazon.co.jp/dp/4797397403/ref=cm_sw_em_r_mt_dp_U_NGakEb305PQ0C の学習ノート
* ISBN-10 4797397403 

## 第1章 AWS認定資格
### AWS認定資格とは？
* ベーシック：全体的な理解
  * クラウドプラクティショナー
* アソシエイト：技術的役割認定
  * ソリューションアーキテクト-アソシエイト等
* プロフェッショナル：最高レベルの技術的役割認定
  * ソリューションアーキテクト-プロフェッショナル等
* 専門知識認定資格：特定の技術分野での高度スキル
  * Machine Learning等

### 出題範囲/合格ライン
1. クラウドの概念：26%
2. セキュリティ：25%
3. テクノロジー：33%
4. 請求と料金：16%

* 試験時間：90分
* 合格ライン：700/1000点

## 第2章 AWSクラウドの概念
* ここの範囲で26%の分量
* クラウドの特長、オンプレとの比較等を把握

### AWSクラウドコンピューティングの6つのメリット
1. Trade capital expense for variable expense
    * 固定費(設備投資費)から柔軟な変動費へ
2. Benefit from massive economies of scale
    * 圧倒的なスケールメリット
    * AWSにサービスを集約することでコスト抑制可能に
3. Stop guessing capacity
    * キャパシティ予測不要に
    * 需要に応じてキャパシティを追加/削減可能に
4. Increase speed and agility
    * 速度と俊敏性の向上
    * 実験やイノベーションにかける時間を増やせる
5. Stop spending money running and maintaining data centers
    * データセンターやその運用保守への投資不要
6. Go global in minutes
    * わずか数分で世界中にデプロイ

* 詳細は https://docs.aws.amazon.com/whitepapers/latest/aws-overview/six-advantages-of-cloud-computing.html
* ひとことで言うと、システムの弾力性が大幅に向上

### クラウドアーキテクチャの設計原理
* Design for Failure (故障に備えた設計)
  * 単一障害点(Single Point of Failure=SPOF)を無くす
  * 1つのDCのみで運用しない、単一のインスタンスのみで構成しない
  * マネージドなサービスを利用しよう
* コンポーネントの分離
  * サービス指向アーキテクチャ。疎結合→スケーリングが大規模に
  * 各コンポーネントは他のコンポーネントは非同期に相互作用
    * 例えばAPサーバとDBはそれぞれブラックボックスとして振る舞う
  * バッチ処理はSQSでキューイングチェーン
  * マイクロサービスアーキテクチャ：システムを小規模サービスに分離しAPIで連携
* 弾力性(伸縮性, Elastic)の実装
  * 柔軟なスケールイン/スケールアウト
    * 巡回スケーリング：一定期間に発生する定期的なスケーリング
    * イベントベーススケーリング：予定されているビジネスイベントに従ったスケーリング
    * オンデマンドの自動スケーリング：負荷をモニタリングし状況に応じてスケーリング
  * サーバ(インスタンス)は使い捨て可能なリソース
* 並列性を考慮
  * ロードバランサ、スケールアウトの考慮
* 動的コンテンツ/静的コンテンツの配置
  * 動的コンテンツ(常時変動するデータ)はコンピューティングインスタンスの近くに
  * 静的コンテンツ(固定データ)はCDN等を利用してエンドユーザーの近くに

### AWS Well-Architectedフレームワーク
* https://aws.amazon.com/jp/architecture/well-architected/
* Well-Architectedフレームワークは、アーキテクト・開発者・ユーザーが、アプリケーションのために安全で高パフォーマンスで耐障害性に優れた効率的なインフラストラクチャを構築できるように設計されている
* フレームワークの5本柱
  1. 運用上の優秀性 (Operation Excellence) ：ビジネス価値実現のための継続的な改善プロセス構築 (ex.デプロイパイプライン)
  2. セキュリティ (Security) ：ビジネス価値を提供しながら、情報・システム・資産を保護する能力 (ex.データの整合性・暗号化)
  3. 信頼性 (Reliability) ：システムの自動障害復旧、高可用性の実現
  4. パフォーマンス効率 (Performance Efficiency) ：システム要件を満たす効率的なコンピューティングリソース配分・維持 (ex.サーバレスアーキテクチャ、グローバルなデプロイ)
  5. コスト最適化 (Cost Optimization) ：最も安価にシステムを実行してビジネス価値を実現 (ex.マネージドサービス適用によるコスト効率化)
* 自分自身で確認するAWS Well-Architected Toolもある
  * 潜在的な問題をチェックしベストプラクティスの提案・計画を立ててくれる

## 第3章 AWSのセキュリティ
### 3-1 責任共有モデル
ユーザーとAWSの責任分界点
* ユーザー：クラウド内のセキュリティ
* AWS：クラウド本体のセキュリティ

### 3-2 AWSクラウドのセキュリティ
AWSセキュリティの4つの利点
1. データの保護
2. コンプライアンス要件に準拠
3. コスト削減：ユーザーの独自設定なく最上位のセキュリティを維持
4. 迅速なスケーリング

#### 責任範囲の考え方
* 物理的なセキュリティ： **AWSの責任範囲**
  1. 環境レイヤー：自然災害等の環境リスクの軽減
  2. 物理的な境界防御レイヤー：DCに保安要員、防御壁、監視カメラ等の物理設備の設置
  3. インフラレイヤー：発電設備、冷暖房設備、消化設備等の設置
  4. データレイヤー：アクセス制限、脅威検出
* ハイパーバイザーのセキュリティ： **AWSのセキュリティの責任範囲**
  * VMエスケープやVMホッピング等のハイパーバイザーをターゲットにした攻撃はAWSが担当
  * 準仮想化(PV)インスタンスについても、最新のAMIや更新パッケージを提供
* 管理プレーン： **ユーザーの責任範囲**
  * 具体的には
    * IDとパスワード
    * キーペア
    * APIキーの管理
    * アクセス制御と権限管理
  * 各種リソースへの権限はAPIキーではなくIAMロールの割り当てを推奨
* アンマネージドサービスのセキュリティ： **ユーザーの責任範囲**
  * IaaS (VPC,EC2,Lambda) 等はユーザーが必要なセキュリティ設定と管理タスクを実施
  * そこに配置するデータやコンテンツの管理もユーザーの責任
* フルマネージドサービスのセキュリティ： **AWSの責任範囲**
  * PaSSやSaaSに該当するサービスのセキュリティ対応
  * 要はユーザー側から触れない部分はAWSが実施

#### セキュリティのベストプラクティス
1. 転送中のデータの保護
    * 適切なプロトコル/暗号化アルゴリズムの選択
2. 蓄積データの保護
    * DB登録時のアプリケーション上でのデータ暗号化
3. AWS資格情報の保護
4. アプリケーションの安全性の確保
    * OSコマンドインジェクション、SQLインジェクション、XSS等の対策

#### 第三者認証
* AWSの物理レイヤーは監査機関による検査を受けており、**AWS Artifact**でデータを提供
* CSA, ISO各種企画, PIC DSSレベル1, SOC1..3
* 国内ビジネスで必要な認証: FinTech, FISC, NISC等

### 3-3 IAM
* IAM: AWS Identity and Access Management
* 各種キーワードを抑える
  * ルートアカウント
  * IAMユーザー
  * IAMグループ
  * APIキー (アクセスキー,シークレットアクセスキー)

#### IAMロール
* EC2, Lambda等の権限付与のためのAPIキーの利用は非推奨。代わりにIAMロールを利用
* AWS Directory ServiceでIAMロールを使用することで、SSO (Single Sign On) 構成にすることも可能

### 3-4 セキュリティグループ
* 許可ルールの指定が可能
* 拒否ルールの指定は不可
* インバンウド/アウトバウンドトラフィックのルールを個別指定

### 3-5 AWS ShieldとAWS WAF
* AWS Shield
  * マネージド型のDDoS攻撃に対する保護サービス
  * DDoS: Distributed Denial of Service attack
  * AWS Shield Standard (無償) と Advanced (有償) がある
  * Advancedを選択するとWAFサービスが無制限に利用、DDoS Response Teamの24,365サポート (フォレンジック・分析)
* AWS WAF
  * WAF: Web Application Firewall
  * WAFの定義はユーザー自身で行う必要があるが、SQLインジェクションはXSSのような一般的な攻撃をグロックするカスタルール、特定のアプリケーションのために設計されるルールを作成可能
  * Webセキュリティルールに基づき課金
  * WAFの適用範囲
    * CloudFront: CDNサービス
    * Application Load Balancer
    * API Gateway

### 3-6 Inspector
* EC2上にデプロイされたアプリケーションのセキュリティとコンプライアンスを向上させるための脆弱性診断を自動で行うサービス
* PCI DSSのようなルールパッケージを利用してスケジュール設定により自動でチェック
* 生成されたコンプライアンスレポートをAWS Artifactから取得可能

#### AWS Key Management Service (KMS)
* AWS上で暗号化キーをかんたんに作成・管理、幅広いAWSサービスやアプリケーションでの使用を制御可能
* CloudTrailと統合されており、すべてのキーの使用ログを表示可能

## 第4章 AWSのテクノロジー
### 4-1 AWSのサービス
* リージョン
* アベイラビリティゾーン
* エッジロケーション

### 4-2 グローバルインフラストラクチャ
#### リージョン
* 全世界に24のリージョン (2020/05現在)
* リージョン内に2つ以上のアベイラビリティゾーン
* マルチサイトアクティブ-アクティブ
  * 複数リージョンに完全に稼働する同一システムを構築
  * 大規模災害時のダウンタイムの最小化

#### アベイラビリティゾーン
* 必ず2つ以上ある→Design for Failureの考え方
* 複数のデータセンターで1つのアベイラビリティゾーン(AZ)を構成
* AZを複数利用することで、耐障害性が高いシステム（負荷分散、レプリケーション、冗長化、フェイルオーバーを実現するアーキテクチャ）をかんたんに実装可能

#### AWSのデータセンター
* どこにあるかは非公開。一見ではDCとはわからない施設
* 警備員の配置、監視カメラ、防御壁等の物理的な保護も厳重にされている

#### エッジロケーション
* リージョンよりもさらに細かく、全世界に42カ国84箇所に200以上存在
* 用途は「低レイテンシーなDNSクエリの実現」「コンテンツの低レイテンシー配信」
* Amazon Route 53: エッジロケーションで利用されるDNSサービス
* Amazon CloudFront: エッジロケーションで利用されるCDN(Contents Delivery Network)サービス
* Route 53/CloudFrontはAWS Shield Standardの保護対象

#### その他の選択肢
* AWS Local Zones: エンドユーザーからより近い場所に配置
* AWS Wavelength: アプリケーションに10ミリ秒未満のレイテンシーを実現
* AWS Outposts: オンプレミス施設でAWSサービスを利用


## 第5章 コンピューティングサービス
### 5-1 EC2
#### 使用した分だけコストが発生
* EC2稼働に対しての料金
  * Amazon Linux, Ubuntuでは秒単位 (最短1分)
  * それ以外は1時間単位で課金
* データ転送料金
  * インターネットや他リージョンのアウトバウンドな転送のみに課金
  * インバウンドや同一リージョンかつ同一AZ内のデータ転送では料金が発生しない
* ストレージ料金　(正確にはEBSに対して)
  * EBSのプロビジョニングしたストレージ容量に対して課金 (1GB単位)

#### インスタンスタイプを変更可能
* 運用開始後もCPUやメモリサイズなどの選択可能
* 検証しながらインスタンスを変更できる

#### セキュリティグループでトラフィックを制御
* インバウンド設定で特定のポート等を許可

#### OSを管理者権限で操作可能
* キーペアを用いた管理者権限でのログイン

#### ユースケースに応じた料金オプション

| オプション | 内容 |
|--|--|
| オンデマンドインスタンス | 料金オプションなし。いわゆる定価料金 |
| リザーブドインスタンス | 長期契約することでディスカウント<br>期間：1年 or 3年<br>支払い方法：前払い、一部前払い、前払いなし<br>スタンダード or コンバーティブル：後者は期間中にインスタンスタイプの変更可能 |
| スケジュールリザーブドインスタンス | 週1回金曜日や、10時〜17時といった定期的な利用時間にかぎってインスタンスを利用する場合にディスカウント |
| スポットインスタンス | キャパシティの利用状況に応じてコストが動的に変換<br>短時間の作業向き |
| Dedicated Hosts | EC2が起動するホストを専有。セキュリティ/ガバナンス要件、ライセンス要件等を満たす目的で使用。インスタンスではなくホストに対しての従量課金。(dedicated：専用の、献身的な) |
| ハードウェア専有インスタンス | アカウント専用のハードウェアでEC2を実行。インスタンスに対しての従量課金だが専有追加料金が必要 |
| Savings Plans | 1年または3年でより柔軟にコスト節約。FargateやLambdaも同様にCompute Savings Plansがある |

### 5-2 ELB
ELB: Elastic Load Balancing
* 冗長構成のEC2に対するリクエストを単一のエンドポイントで受け付けるためのサービス
* EC2インスタンスの可用性を高めることができる

#### ELBの特徴
* ロードバランサータイプ
* ヘルスチェック
* インターネット向け/内部向け
* 高可用性のマネージドサービス
* クロスゾーン負荷分散

#### ロードバランサータイプ

| タイプ | 機能 |
|--|--|
| Application Load Balancer | HTTPまたはHTTPSのリクエストを負荷分散<br>Webアプリケーションに対して高度な機能を提供 |
| Network Load Balancer | HTTP,HTTPS以外のTCPプロトコルに対して適用<br>Static IPアドレスを使用可<br>数百万リクエスト/秒を処理可能 |
| Classic Load Balancer | 以前のタイプのロードバランサー<br>現状は新規でこれを利用することはない |

#### ヘルスチェック
* 指定されたURLまたはpingに対するハートビート
* エラーが継続するとUnhealthyとしリクエストを送信する対象から除外

#### インターネット向け/内部向け
* インターネット向けだけでなく内部向けに作ることも可能
* ELBのDNSをパブリックIPアドレスに紐づけるか、プライベートIPアドレスに紐づけるかで変えられる
* ELBに対してのトラフィックは、EC2と同様にセキュリティグループで制御可能

#### 高可用のマネージドサービス
* ELBそのものは単一障害点（SPOF）とはならない
* AWSが管理する高可用性なサービスのため

#### クロスゾーン負荷分散
* その名の通り、**AZを超えての負荷分散** （対象ターゲットで負荷の均等化）
* Application Load Balancerでは常に有効、Network Load Balancerでは有効/無効を選択できる
* 有効にしていると、すべてのターゲットインスタンスに対してリクエストが送信される→全ターゲットインスタンスで負荷を均等にする

### 5-3 Auto Scaling
* EC2インスタンスを条件に応じて自動的に追加/削減できる
* Auto Scalingのメリットは、高可用性、耐障害性、コスト効率化
* Auto Scalingそのものは無料で利用可能

#### 垂直スケーリングと水平スケーリング

| 項目 | 垂直スケーリング | 水平スケーリング |
|--|--|--|
| スケール方法 | サイズを変更 | インスタンス数を変更 |
| 影響 | あり（検証や停止が必要） | なし（事前に設計） |
| 上限 | インスタンスの最大サイズ | なし |

水平スケーリングの方がすケースしやすく、「スケーラビリティを確保する
」というベストプラクティスを簡単に実現できる。

#### Auto Scalingの設定
* 何を：起動設定 (Launch Template)
  * AMIを指定するなど、どれをどのような形で起動するか
* どこで：Auto Scalingグループ
  * EC2インスタンスを起動するゾーン/サブネットを設定
* いつ：Auto Scalingポリシー
  * 起動/終了するタイミングや条件を設定
    * ターゲットポリシー：CPU率等にもとづき設定
    * シンプルポリシー：CloudWatchのアラームにもとづき設定
    * ステップポリシー：複数フェーズでの追加/削除を設定

#### アプリケーションデプロイの自動化
* AMIからのブートストラップ
  * ユーザーデータ：インスタンス起動直後の実行スクリプト
  * メタデータ：AWSから取得するインスタンス固有の情報
    * `curl --silent http://169.254.169.254/latest/meta-data/`

#### ELBとAuto Scalingを使用したスケーラブルなWebアプリケーション
1. ALBの作成
    * セキュリティグループ、ルーティング等の設定
    * SSLターミネーション
      * ALBのリスナーをHTTPSにしてSSL証明書の設定を行い、ターゲットに対してはHTTPでアクセスする構成を作ることもできる
      * ユーザーがアクセスするドメインに対しての証明書を管理するのみいなり、ターゲットとなっているインスタンス１つ１つに対して証明書を管理する必要はない
2. 起動設定の作成
    * AMI、インスタンスタイプ、ユーザーデータ、セキュリティグループ等の設定
3. Auto Scalingグループの作成
    * AMI、ヘルスチェック、Auto Scalingポリシーの作成
4. 動作確認

> ELB, Auto Scaling, CloudWatchの3つのサービスで
> 自律的でスケーラブルなアプリケーションを構築できる

### 5-4 Lambda
#### Lambdaの特徴
* サーバの構築・管理が不要
  * OSの更新、セキュリティパッチの適用、冗長化・障害管理からの開放
* 一般的なプログラム言語をサポート
* 並列処理/スケーリング
  * デフォルトではアカウント全体で1000が制限（引き上げ可）
  * 同時実行数の上限を設定できる
* 柔軟なリソース設定
  * メモリ割り当て、タイムアウト設定等
* ミリ秒単位の無駄のない課金
  * 課金の最小単位がミリ秒
  * しかも、月間合計の使用メモリが400,000GB/秒となるまでは無料
  * リクエストに対する課金も、100万リクエスト/月までは無料
* 他のAWSサービスとの連携

### 5-5 その他のコンピューティングサービス
* Amazon ECS: Amazon Elastic Container Service
* Amazon Lightsail: 仮想プライベートサーバ。EC2よりパワーは低いが低料金
* AWS Batch: フルマネージドのバッチ処理実行環境サービス

## §6 ストレージサービス
### 6-1 EBS
ブロックストレージサービス。Elasticと言うだけあって弾力性がある。

* AZ内でレプリケート
  * AWSが同じAZ内の複数サーバに自動的にレプリケートしている（ユーザーからは見えない）
* ボリュームタイプや容量の変更が可能
  * ボリュームタイプ
    * 汎用SSD： 最大**16,000 IOPS**
    * プロビジョンドIOPS: 最大**64,000 IOPS**
    * SSDの性能を必要とせず、コスト削減したい場合
      * スループット最適化HDD
    *   Cold HDD
    * 使用開始後にオンラインでボリュームタイプを変更可
  * 容量
    * 使用開始後に増量することは可能
    * 容量に対して課金が発生
* 高い耐久性のスナップショト
  * 自動スナップショットまたは手動スナップショットを実行可能（バックアップではないので注意）
  * 実体はS3にあるので、自動的に冗長化＆耐久性はイレブンナイン(99.999999999%)
* ボリュームの暗号化
  * ボリュームやそのスナップショットが暗号化される
  * EC2インスタンスとのデータの暗復号は透過的に行われるので、ユーザーの追加操作はなし
* 永続化ストレージ
  * EC2インスタンスを停止してもEBSのデータは永続的に保存される

##### インスタンスストア
* EC2インスタンスが起動している間のみデータを保持する、EC2内部の一時的なローカルストレージ (tmpfsみたいなもの？)
* 無料で使用可能

### 6-2 S3
S3: Amazon Simple Storage Service。完全マネージド型のオブジェクトストレージ。

* 無制限のストレージ容量
  * バケットのデータ容量は無制限。空き容量が...といった問題から解放
  * 1ファイルあたりは5TBの制限あり
* 高い耐久性
  * オブジェクト単位で複数のAZにまたがって自動的に冗長化して保存
  * S3の耐久性はイレブンナイン(99.999999999%)
    * S3の可用性は99.99%なので注意
* インターネット経由でアクセス
  * HTTP/HTTPS経由、AWS CLIによるAPI経由でアクセス
* セキュリティ
  * ACL（アクセスコンロールリスト）
    * 特定のAWSアカウントに対するアクセスを制御
    * 不特定のユーザーに対するアクセスを制御
    * バケット単位、オブジェクト単位で設定可能
  * バケットボリシー
    * 特定のIPアドレスに対して等、細かい設定が可能
  * IAMポリシー
    * 特定のインスタンスに対しアクセスを許可
    * APIアクセスキーによる権限付与は現在は非推奨
  * 通信/保存データの暗号化
* S3の料金
  1. ストレージ料金
      * 標準
        * 1ヶ月を通しての平均保存量で料金算出
        * 東京リージョンで0.025USD/GB (最初の50TB〜)
      * 低頻度アクセスストレージ（標準IA）
        * 東京リージョンで0.019USD/GB
        * リクエスト料金は標準よりも高いので、バックアップ用途がメイン
      * 1ゾーン低頻度アクセスストレージ (1ゾーンIA)
        * 東京リージョンで0.0152USD/GB
        * 複数AZへの自動的な冗長化がされないので、多少のダウンタイムが発生しても困らない
      * Amazon Glacier
        * 東京リージョンで0.005USD/GB
        * 取り出しには時間がかかるので、アーカイブ用途
  2. リクエスト料金
      * データのダウンロード/アップロード要求に対してかかる料金
  3. データ転送料金
      * インバウンドでは料金は発生しない
      * 同一リージョンでのアウトバウンドでは料金は発生しない
      * インターネットまたは別リージョンへのアウトバウンドで料金が発生
  4. 保存データの暗号化
      * 複数の方法から選択可能
          1. S3のキーを使用したサーバサイドの暗号化
          2. KMS（ユーザーがAWS上で暗号化のためのキーを作成・管理し暗号化を制御）を使用したサーバサイド、またはクライアントサイド暗号化
          3. お客様独自のキーを使用したサーバサイド、またはクライアントサイド暗号化
* Amazon S3 Transfer Acceleration
  * エッジロケーションを利用し、クライアントとS3バケットの間で長距離にわたるファイル転送を高速・簡単・安全に行えるサービス

### 6-3 その他のストレージサービス
* EFS: Amazon Elastic File System
  * 複数のEC2インスタンスでマウントして共有利用できるファイルストレージサービス
* Storage Gateway
  * オンプレミスのアプリケーションとAWSのストレージサービスをシームレスで接続するサービス
* Snowball
  * 物理デバイスを利用して、ペタバイト級の大容量データ転送を実行できるサービス
  * 主な用途は、オンプレミスからAWSヘのマイグレーション
  * エクサバイト級のデータ転送はSnowmobile

## §7 ネットワークサービス
### 7-1 VPC
* 複数のAZをまたがって作成可
* CIDRでIPアドレスの範囲を定義 (ex `10.0.0.0/16`)
* サブネット
  * 最初の4つはAWSで予約
  * `10.0.1.0`: ネットワークアドレス
  * `10.0.1.1`: VPCルータ用
  * `10.0.1.2`: AWSで予約
  * `10.0.1.3`: 将来利用のためにAWSで予約
  * `10.0.1.255`: ネットワークブロードキャストアドレス
  * パブリックサブネット: インターネットゲートウェイに対しての経路を持つルートテーブルに関連付けられたサブネット
  * プライベートサブネット: インターネットゲートウェイに対しての経路を持たないルートテーブルに関連付けられたサブネット
* インターネットゲートウェイ
  * 作成時にVPCにアタッチする
  * デフォルトで水平スケーリングされており単一障害点(SPOF)にならない
* ルートテーブル
  * サブネットの経路を定義する。サブネット毎に設定が必須
* セキュリティグループ
  * VPC内のリソース（EC2,ELB,RDSなど）単位のトラフィックを制御できる（サブネット単位ではない）。**VPC外とのトラフィックも制御できる**
  * ウェブ層、アプリケーション層、DB層といったレイヤー単位でトラフィック制御を設定といった応用ができる
  * セキュリティグループはVPCを指定して作成（VPC内で有効）
* ネットワークACL(アクセスコントロールリスト)
  * **サブネットに対して設定する**仮想ファイアウォール。allowリスト/denyリストでトラフィックを制御
  * デフォルトではすべてのインバウンド/アウトバウンドを許可
  * セキュリテイグループで要件を十分満たせるなら、特にデフォルトのままでも構わない

#### ハイブリッド環境構成
* ハイブリッド環境構成：オンプレミスとクラウド(VPC)をVPNまたは専用線で接続する構成
* ハードウェアVPN接続
  * AWSで作成した仮想プライベートゲートウェイとオンプレミス側のカスタマーのゲートウェイのVPN接続を作成
  * 社内のプライベートネットワーのみで稼働する業務アプリをAWSで実現
  * 仮想プライベートゲートウェイはVPCに1つアタッチ。カスタマーゲートウェイ側のメーカーに応じて設定をダウンロード
* ダイレクトコネクト (AWS Direct Connect)
  * AWSとカスタマーの環境を専用線でネットワーク接続
  * セキュリティやコンプライアンスの要件を満たすために選択
* VPCピアリング
  * 複数のVPC同士を接続
  * 同じリージョン・アカウントだけではなく、別のリージョン、別のアカウントの複数のVPCとも接続可能
* 他にも、大規模ネットワークが構築可能なAWS Transit Gateway、クライアントベースのAWS Client VPNがある

### 7-2 CloudFront
* 世界中の150か所のエッジロケーションを使い、最も低いレイテンシー（遅延度）のコンテンツを配信できるCDN (Contents Delivery Network) サービス
* S3やEC2から配信するより、CloudFrontにキャッシュを持ち、ユーザーにそのコンテンツを返す方が効率的に提供できる

#### CloudFrontの特徴
* キャッシュによる低レイテンシーの配信
  * CloudFrontを使用すると1人目はオリジナルのコンテンツ配信からCloudFront経由でデータを受け取るが、2人目以降はCloudFrontのキャッシュからコンテンツを受け取るため、遅延が軽減される
* ユーザーの近くからの低レイテンシーの配信
  * ユーザーの近くのエッジロケーションからコンテンツが配信
  * エッジロケーションにキャッシュがないタイミングで、エッジロケーションと各リージョン間はAWSのバックボーンネットワークを経由しているので、直接アクセスするよりも転送が速い
* 安全性の高いセキュリティ
  * CloudFrontはホストが所有しているドメイン証明書を設定できるため、ユーザーからHTTPSを受けることができ、通信データを保護できる
  * 証明書はAWS Certificate Managerを使用すると、追加費用なしで作成できる

### 7-3 Route 53
* Amazon Route 53: DNS(ドメインネームシステム)サービス
* ドメインに対してIPアドレスをマッピングしてユーザーからの問い合わせに回答
* Route 53はエッジロケーションが使用される

#### Route 53の主な特徴
* 様々なルーティング機能
  * シンプルレーティング：問い合わせに対し、単一のIPアドレス情報を回答するシンプルなルーティング
  * レイテンシーベースのルーティング/Geo DNS
    * 1つのドメインに対して複数のDNSレコードを用意
    * 地理的な場所を近くにしてレイテンシー（遅延度）が低くなるようルーティングを行う
  * 加重ラウンドロビン
    * 1つのドメインに対して複数のDNSレコードを用意し割合を決め、その割合に応じて回答を返す
  * 複数値回答
    * 複数のレコードからランダムに回答を返す
* 高可用性を実現するヘルスチェックとフェイルオーバー
  * ルーティングに対するプライマリとセカンダリを事前に設定
  * ヘルスチェックとフェイルオーバーを使用することで、プライマリに障害が発生すればセカンダリーに切り替え。プライマリが復旧しヘルスチェックが成功すれば再び元のルーティングへ
* ルートドメイン(Zone Apex)のエイリアスレコード
  * Aレコードなどの各レコードセットにエイリアス(=Zone Apex)を設定することができる
  * トップレベルのルートドメインにも設定できるため、ルートドメインにも複数のリソースを割り当て可用性の高いシステムを構成できる

## §8 データベースサービス
### 8-1 RDS
#### RDSとEC2の違い
* メンテナンス: OSやミドルウェアやそれらの保守作業を意識する必要がない
* バックアップ
  * 自動バックアップ(デフォルト7日、最大35日)。手動スナップショットを作成するとそのバックアップを永続化できる
  * ポイントタイムリカバリー: 自動バックアップを設定している期間内で、秒数まで指定して特定の時点のインスタンスを復元できる（トランザクションログが保存されていることで実現可能）
* 高可用性
  * マルチAZをオンにするとAZをまたいだレプリケーションが自動的に行われる
  * マスターに障害が発生した場合のフェイルオーバーも自動的に行われる
  * また、リードレプリカによる読み込み負荷の軽減や、他のリージョンへのレプリカ作成（クロスリージョンレプリカ）も行える

#### Amazon Aurora
AWSがクラウドに最適化して再設計したRDBMS
* バックアップが非常に強固
* スタンバイにアクセスできる（リードレプリカがマスターに昇格） 
  * ただし、手動のため自動フェイルオーバーをする場合はマルチAZを採用する
* リードレプリカは最大15個作成可能
* RDS MySQLに比べて5倍の性能
* ディスク容量を見込みで確保しなくて自動で増加

#### DMS
* 移行時のシステムダウンタイムを最小限に
* 異なったデータベースエンジンでも移行可能
* 移行先のスキーマ作成もSCT (Schema Conversion Tool) で自動作成

### 8-2 DynamoDB
* 非リレーショナルのフルマネージド型データベースサービス
* 自動的に複数のAZにデータが同期=初めからマルチAZな環境
* データ容量は無制限、使用している容量のみが課金対象

#### DynamoDBとRDSの違い
* 最大の違いは、RDSはリレーショナルデータベースなのに対し、DynamoDBは非リレーショナル（またはNoSQL。厳密には非リレーショナルとNoSQLは意味が違うが…）
* スケーリング
  * RDSは垂直スケーリングなのに対し、DynamoDBは水平スケーリング
    * RDSは厳密なトランザクション処理は得意だが、大量のアクセスには不向き
    * DynamoDBは大量のアクセスがあっても性能を維持できるが、厳密なトランザクションや複雑なクエリは不向き
* データの構造
  * RDSはSQL、DynamoDBはKVS (キーバリュースト。1つのキーに対し複数のアイテム)

### 8-3 その他のデータベースサービス
* Amazon Redshift
  * 高速でシンプルなデータウェアハウスサービス。大規模なデータ分析にも対応
* Amazon ElastiCache
  * インメモリ・データストアサービス
  * RedisとMemcachedのマネージドサービスとして使用可能
  * DBのクエリ結果のキャッシュやアプリケーションのセッション情報を管理する用途で使用
* Amazon Napture
  * フルマネージドのグラフデータベースサービス
  * 関係性や相関情報を扱い、SNS・レコメンデーション(提案)エンジン・経路案内・物流最適化などのアプリケーション用途で使用される

## §9 管理サービス
### 9-1 CloudWatch
* 標準メトリクス
  * EC2ならCPU使用率やディスクI/O等、RDSならメモリやディスク使用量等
  * 使用するサービスによって取得される情報が異なる
* カスタムメトリクス
  * PutMetricData APIによってカスタムメトリクスを仕込むことが可能
  * カスタムメトリクスに書き込むプログラムはCloudWatchエージェントとしてAWSから提供されている
    * https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/Install-CloudWatch-Agent.html
* ログの収集
  * CloudWatch Logs: アプリケーションのログ収集サービス
  * EC2であればローカルの任意のログをCloudWatch Logsで転送可能
  * 転送されたログはCloudWatch Logsのダッシュボードからフィルタリング等が可能
  * ファイルログを持つ必要がなくなるので、EC2をよりステートレスにできる
* アラーム
  * 各サービスから収集したメトリクス値に対してアラームを設定可能
    * 例えば…
      * EC2のCPU利用率が80%を上回っていた
      * ログに "Out of Memory" が2回出現した
      * RDSのディスク残量が10GB未満になったまま5分経過した
  * アラームに対して行えるアクション
    * EC2の回復
    * Auto Scalingの実行
    * SNSへの通知
      * SNS: Amazon Simple Notification Service
      * SNSへ通知することにより、Eメールでの送信、Lambdaを起動等か可能
      * SNSはフルマネージド型のpub/subメッセージングサービス。プッシュ型でコンポーネント間のメッセージ間が可能
      * (一方、SQS (Simple Queue Service) はメッセージキューイングサービスで、ポーリング方式による通知を行う)
* 保存期間
  * メトリクス
    * 60秒未満のデータポイント（高分解能カスタムメトリクス）：3時間
    * 1分のデータポイント（詳細モニタリング）：15日間
    * 5分のデータポイント（標準）：63日間
    * 1時間のデータポイント：445日
  * CloudWatch Logs
    * 任意ほ保存期間を設定。消去しないことも可能

## 9-2 Trusted Advisor
* AWSアカウント環境の状態を自動チェックし、ベストプラクティスに対してどうであったかを示すアドバイスをレポート
* コスト最適化
  * 使用率の低いインスタンス
    * 使っていないや検証やテストで使ったまま終了し忘れているEC2インスタンス、過剰にスペックが高いインスタンスのチェック
    * EC2だけでなくEBSやRedshift等、他のサービスもチェックされる
  * リザーブドインスタンスの最適化
    * EC2の利用状況をチェックして、リザーブドインスタンスを購入した方がよいかレポート
* パフォーマンス
   * パフォーマンスを低下させる原因、その原因となる設定等がないかをチェック
     * 使用率の高いEC2インスタンス
     * セキュリティグループルールの増大
     * コンテンツ配信の最適化
       * CloudFrontのキャッシュがどれだけ使われたかのヒット率もチェック
* セキュリティ
  * S3バケットのアクセス許可
  * セキュリティグループの開かれたポート
    * リスクの高いポートが送信元無制限でアクセスOKとなっている場合等
  * パブリックなスナップショット
  * ルートアカウントのMFA,IAMの使用
* フォールトトレランス
  * Fault Tolerant：耐障害性、システムの一部が停止しても予備の系統に切り替えられること
  * EBSのスナップショット
    * 作成されているか、最後に作成されていてどの程度経過しているか
  * EC2,ELBの最適化
    * 複数のAZにバランスよく配置されているか
    * ELBではクロスゾーン負荷分散、ELBではConnection Draining（セッション完了を待ってから切り離す機能）が無効になっているロードバランサーがないかがチェックされる
* サービス制限
  * ソフトリミット
    * AWSアカウントを作った時点でいくつかのサービスに適用されている制限
    * 謝った操作 or 不正アクセスによる意図しない請求を回避
    * AWSへ申請を行うことでリミットを解除できる

### 9-3 その他の管理ツール
### CloudTrail
* AWSアカウント内のすべてのAPI呼び出し履歴を記録。監査や調査に使用できる
* 類似のサービスでAWS Configがある。これはAWSリソースの設定を評価、監査、審査できるサービス

### CloudFormation
* AWSの各リソースを含めた環境を自動作成/更新/管理する
* JSON or YAML形式で記述されたテンプレートからStackというリソースの集合体を作成
* CloudFormationを使用することで、同一のAWS環境を何度でも自動で構築可能
* また、これらの自動的なプロビジョニングをコードを用いて行えるため、AWS CodeCommit等のリポジトリでバージョン管理も行える

### Elastic Beanstalk
* Webアプリケーション環境をかんたんに構築できるサービス
* CloudFormationに似ているが、テンプレートを作成する必要はなく、設定パラメータを与えることで環境を作成可能
* AWSサービスすべてを網羅している訳ではなく、Webアプリケーションやタスク実行環境の構築に向いている

## §10 請求と料金
### 10-1 AWS料金モデル
* 使った分だけ従量課金。資本の支出を変動費に
* 課金体系はサービスによって異なる。多彩な料金モデルを持つ

### 10-2 請求ダッシュボード
* 請求書 (Billing)
  * 月別の請求額や内訳を確認できる。その月の途中でも可
* コストエクスプローラーとコスト配分タグ
  * コストエクスプローラーで費用を可視化
  * コスト配分のためにタグ（リソースタグ）を活用すると便利
* 請求アラーム
  * CloudWatchメトリクスで請求金額を扱えSNSサービスと連携できる
  * 設定予算を超えると予測されたときにアラートを発信するAWS Budgetsというサービスもある

### 10-3 マルチアカウントの運用
* AWS Organizations
  * 複数のアカウントの作成を自動化して一括管理。例えば、ビジネスニーズを反映したアカウントのグループを作成し、それらのグループにポリシーを適用して管理できる
* 一括請求（コンソリデーティッドビリング）
  * Consolidated Billing: 複数アカウントの請求を1つにまとめる
  * 複数アカウントの合計使用量による **ボリュームディスカウント** を受けられる可能性もある

### 10-4 AWSのサポートプラン
* https://aws.amazon.com/jp/premiumsupport/plans/
* 全部覚えるのはしんどいので要点だけ
* ビジネスで使う場合はビジネスプラン以上がおすすめらしい。24hサポートがあるから

* ベーシックプラン
  * 個人でお遊びでつかうための無料のサポートプラン
  * 技術サポートはヘルスチェックについてのみ
  * Trusted Advisorは最低限の項目のみ
* 開発者プラン
  * 29USD or 使用料の3%の大きい方
  * 技術サポートを１ユーザーのみ受けられる（9:00〜18:00）
  * Trusted Advisorは最低限の項目のみ
* ビジネスプラン
  * 100USD or 使用料に応じた計算式の大きい方
  * 技術サポートのユーザー数は無制限（24h)
  * Trusted Advisorは全項目
  * サポートAPIの使用可
  * サードパーティソフトウェアのサポート
* エンタープライズプラン
  * 15,000USD or 使用料に応じた計算式の大きい方
  * 技術サポートのユーザー数は無制限（24h)
  * Trusted Advisorは全項目
  * **テクニカルアカウントマネージャー (TAM)**
    * 顧客がAWS上で構築するソリューションを効率良く運用するための支援
    * 要請があれば、定期的なパフォーマンスレビューにも参加してくれる
  * サポートコンシェルジュ
  * ホワイトグローブケースルーティング
    * 問題をあげた時にAWSの各部署が連携して優先対応してくれるっぽい

### 10-5 その他の請求サポートツール
* AWS簡易見積もりサービス
  * https://calculator.s3.amazonaws.com/index.html?lng=ja_JP
  * 事前に請求見込み金額を計算可能
  * AWSマネジメントコンソールにログインしなくても使える
* AWS TCO計算ツール
  * TCO: Total Cost of Ownership
  * AWSへの移行・導入を検討している際に、オンプレミス構築とのコスト比較をレポートしてくれる
  * AWSマネジメントコンソールにログインしなくても使える 

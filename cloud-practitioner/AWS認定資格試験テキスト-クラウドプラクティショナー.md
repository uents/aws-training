# AWS認定資格テキスト AWS認定クラウドプラクティショナー
* https://www.amazon.co.jp/dp/4797397403/ref=cm_sw_em_r_mt_dp_U_NGakEb305PQ0C の学習ノート
* ISBN-10 4797397403 

## 第1章 AWS認定資格
### AWS認定資格とは？
* ベーシック：全体的な理解
  * クラウドプラクティショナー
* アソシエイト：技術的役割認定
  * ソリューションアーキテクト-アソシエイト等
* プロフェッショナル：最高レベルの技術的役割認定
  * ソリューションアーキテクト-プロフェッショナル等
* 専門知識認定資格：特定の技術分野での高度スキル
  * Machine Learning等

### 出題範囲/合格ライン
1. クラウドの概念：26%
2. セキュリティ：25%
3. テクノロジー：33%
4. 請求と料金：16%

* 試験時間：90分
* 合格ライン：700/1000点

## 第2章 AWSクラウドの概念
* ここの範囲で26%の分量
* クラウドの特長、オンプレとの比較等を把握

### AWSクラウドコンピューティングの6つのメリット
1. Trade capital expense for variable expense
    * 固定費(設備投資費)から柔軟な変動費へ
2. Benefit from massive economies of scale
    * 圧倒的なスケールメリット
    * AWSにサービスを集約することでコスト抑制可能に
3. Stop guessing capacity
    * キャパシティ予測不要に
    * 需要に応じてキャパシティを追加/削減可能に
4. Increase speed and agility
    * 速度と俊敏性の向上
    * 実験やイノベーションにかける時間を増やせる
5. Stop spending money running and maintaining data centers
    * データセンターやその運用保守への投資不要
6. Go global in minutes
    * わずか数分で世界中にデプロイ

* 詳細は https://docs.aws.amazon.com/whitepapers/latest/aws-overview/six-advantages-of-cloud-computing.html
* ひとことで言うと、システムの弾力性が大幅に向上

### クラウドアーキテクチャの設計原理
* Design for Failure (故障に備えた設計)
  * 単一障害点(Single Point of Failure=SPOF)を無くす
  * 1つのDCのみで運用しない、単一のインスタンスのみで構成しない
  * マネージドなサービスを利用しよう
* コンポーネントの分離
  * サービス指向アーキテクチャ。疎結合→スケーリングが大規模に
  * 各コンポーネントは他のコンポーネントは非同期に相互作用
    * 例えばAPサーバとDBはそれぞれブラックボックスとして振る舞う
  * バッチ処理はSQSでキューイングチェーン
  * マイクロサービスアーキテクチャ：システムを小規模サービスに分離しAPIで連携
* 弾力性(伸縮性, Elastic)の実装
  * 柔軟なスケールイン/スケールアウト
    * 巡回スケーリング：一定期間に発生する定期的なスケーリング
    * イベントベーススケーリング：予定されているビジネスイベントに従ったスケーリング
    * オンデマンドの自動スケーリング：負荷をモニタリングし状況に応じてスケーリング
  * サーバ(インスタンス)は使い捨て可能なリソース
* 並列性を考慮
  * ロードバランサ、スケールアウトの考慮
* 動的コンテンツ/静的コンテンツの配置
  * 動的コンテンツ(常時変動するデータ)はコンピューティングインスタンスの近くに
  * 静的コンテンツ(固定データ)はCDN等を利用してエンドユーザーの近くに

### AWS Well-Architectedフレームワーク
* https://aws.amazon.com/jp/architecture/well-architected/
* Well-Architectedフレームワークは、アーキテクト・開発者・ユーザーが、アプリケーションのために安全で高パフォーマンスで耐障害性に優れた効率的なインフラストラクチャを構築できるように設計されている
* フレームワークの5本柱
  1. 運用上の優秀性 (Operation Excellence) ：ビジネス価値実現のための継続的な改善プロセス構築 (ex.デプロイパイプライン)
  2. セキュリティ (Security) ：ビジネス価値を提供しながら、情報・システム・資産を保護する能力 (ex.データの整合性・暗号化)
  3. 信頼性 (Reliability) ：システムの自動障害復旧、高可用性の実現
  4. パフォーマンス効率 (Performance Efficiency) ：システム要件を満たす効率的なコンピューティングリソース配分・維持 (ex.サーバレスアーキテクチャ、グローバルなデプロイ)
  5. コスト最適化 (Cost Optimization) ：最も安価にシステムを実行してビジネス価値を実現 (ex.マネージドサービス適用によるコスト効率化)
* 自分自身で確認するAWS Well-Architected Toolもある
  * 潜在的な問題をチェックしベストプラクティスの提案・計画を立ててくれる

## 第3章 AWSのセキュリティ
### 3-1 責任共有モデル
ユーザーとAWSの責任分界点
* ユーザー：クラウド内のセキュリティ
* AWS：クラウド本体のセキュリティ

### 3-2 AWSクラウドのセキュリティ
AWSセキュリティの4つの利点
1. データの保護
2. コンプライアンス要件に準拠
3. コスト削減：ユーザーの独自設定なく最上位のセキュリティを維持
4. 迅速なスケーリング

#### 責任範囲の考え方
* 物理的なセキュリティ： **AWSの責任範囲**
  1. 環境レイヤー：自然災害等の環境リスクの軽減
  2. 物理的な境界防御レイヤー：DCに保安要員、防御壁、監視カメラ等の物理設備の設置
  3. インフラレイヤー：発電設備、冷暖房設備、消化設備等の設置
  4. データレイヤー：アクセス制限、脅威検出
* ハイパーバイザーのセキュリティ： **AWSのセキュリティの責任範囲**
  * VMエスケープやVMホッピング等のハイパーバイザーをターゲットにした攻撃はAWSが担当
  * 準仮想化(PV)インスタンスについても、最新のAMIや更新パッケージを提供
* 管理プレーン： **ユーザーの責任範囲**
  * 具体的には
    * IDとパスワード
    * キーペア
    * APIキーの管理
    * アクセス制御と権限管理
  * 各種リソースへの権限はAPIキーではなくIAMロールの割り当てを推奨
* アンマネージドサービスのセキュリティ： **ユーザーの責任範囲**
  * IaaS (VPC,EC2,Lambda) 等はユーザーが必要なセキュリティ設定と管理タスクを実施
  * そこに配置するデータやコンテンツの管理もユーザーの責任
* フルマネージドサービスのセキュリティ： **AWSの責任範囲**
  * PaSSやSaaSに該当するサービスのセキュリティ対応
  * 要はユーザー側から触れない部分はAWSが実施

#### セキュリティのベストプラクティス
1. 転送中のデータの保護
    * 適切なプロトコル/暗号化アルゴリズムの選択
2. 蓄積データの保護
    * DB登録時のアプリケーション上でのデータ暗号化
3. AWS資格情報の保護
4. アプリケーションの安全性の確保
    * OSコマンドインジェクション、SQLインジェクション、XSS等の対策

#### 第三者認証
* AWSの物理レイヤーは監査機関による検査を受けており、**AWS Artifact**でデータを提供
* CSA, ISO各種企画, PIC DSSレベル1, SOC1..3
* 国内ビジネスで必要な認証: FinTech, FISC, NISC等

### 3-3 IAM
* IAM: AWS Identity and Access Management
* 各種キーワードを抑える
  * ルートアカウント
  * IAMユーザー
  * IAMグループ
  * APIキー (アクセスキー,シークレットアクセスキー)

#### IAMロール
* EC2, Lambda等の権限付与のためのAPIキーの利用は非推奨。代わりにIAMロールを利用
* AWS Directory ServiceでIAMロールを使用することで、SSO (Single Sign On) 構成にすることも可能

### 3-4 セキュリティグループ
* 許可ルールの指定が可能
* 拒否ルールの指定は不可
* インバンウド/アウトバウンドトラフィックのルールを個別指定

### 3-5 AWS ShieldとAWS WAF
* AWS Shield
  * マネージド型のDDoS攻撃に対する保護サービス
  * DDoS: Distributed Denial of Service attack
  * AWS Shield Standard (無償) と Advanced (有償) がある
  * Advancedを選択するとWAFサービスが無制限に利用、DDoS Response Teamの24,365サポート (フォレンジック・分析)
* AWS WAF
  * WAF: Web Application Firewall
  * WAFの定義はユーザー自身で行う必要があるが、SQLインジェクションはXSSのような一般的な攻撃をグロックするカスタルール、特定のアプリケーションのために設計されるルールを作成可能
  * Webセキュリティルールに基づき課金
  * WAFの適用範囲
    * CloudFront: CDNサービス
    * Application Load Balancer
    * API Gateway

### 3-6 Inspector
* EC2上にデプロイされたアプリケーションのセキュリティとコンプライアンスを向上させるための脆弱性診断を自動で行うサービス
* PCI DSSのようなルールパッケージを利用してスケジュール設定により自動でチェック
* 生成されたコンプライアンスレポートをAWS Artifactから取得可能

#### AWS Key Management Service (KMS)
* AWS上で暗号化キーをかんたんに作成・管理、幅広いAWSサービスやアプリケーションでの使用を制御可能
* CloudTrailと統合されており、すべてのキーの使用ログを表示可能

## 第4章 AWSのテクノロジー
### 4-1 AWSのサービス
* リージョン
* アベイラビリティゾーン
* エッジロケーション

### 4-2 グローバルインフラストラクチャ
#### リージョン
* 全世界に24のリージョン (2020/05現在)
* リージョン内に2つ以上のアベイラビリティゾーン
* マルチサイトアクティブ-アクティブ
  * 複数リージョンに完全に稼働する同一システムを構築
  * 大規模災害時のダウンタイムの最小化

#### アベイラビリティゾーン
* 必ず2つ以上ある→Design for Failureの考え方
* 複数のデータセンターで1つのアベイラビリティゾーン(AZ)を構成
* AZを複数利用することで、耐障害性が高いシステム（負荷分散、レプリケーション、冗長化、フェイルオーバーを実現するアーキテクチャ）をかんたんに実装可能

#### AWSのデータセンター
* どこにあるかは非公開。一見ではDCとはわからない施設
* 警備員の配置、監視カメラ、防御壁等の物理的な保護も厳重にされている

#### エッジロケーション
* リージョンよりもさらに細かく、全世界に42カ国84箇所に200以上存在
* 用途は「低レイテンシーなDNSクエリの実現」「コンテンツの低レイテンシー配信」
* Amazon Route 53: エッジロケーションで利用されるDNSサービス
* Amazon CloudFront: エッジロケーションで利用されるCDN(Contents Delivery Network)サービス
* Route 53/CloudFrontはAWS Shield Standardの保護対象

#### その他の選択肢
* AWS Local Zones: エンドユーザーからより近い場所に配置
* AWS Wavelength: アプリケーションに10ミリ秒未満のレイテンシーを実現
* AWS Outposts: オンプレミス施設でAWSサービスを利用


## 第5章 コンピューティングサービス
### 5-1 EC2
#### 使用した分だけコストが発生
* EC2稼働に対しての料金
  * Amazon Linux, Ubuntuでは秒単位 (最短1分)
  * それ以外は1時間単位で課金
* データ転送料金
  * インターネットや他リージョンのアウトバウンドな転送のみに課金
  * インバウンドや同一リージョンかつ同一AZ内のデータ転送では料金が発生しない
* ストレージ料金　(正確にはEBSに対して)
  * EBSのプロビジョニングしたストレージ容量に対して課金 (1GB単位)

#### インスタンスタイプを変更可能
* 運用開始後もCPUやメモリサイズなどの選択可能
* 検証しながらインスタンスを変更できる

#### セキュリティグループでトラフィックを制御
* インバウンド設定で特定のポート等を許可

#### OSを管理者権限で操作可能
* キーペアを用いた管理者権限でのログイン

#### ユースケースに応じた料金オプション

| オプション | 内容 |
|--|--|
| オンデマンドインスタンス | 料金オプションなし。いわゆる定価料金 |
| リザーブドインスタンス | 長期契約することでディスカウント<br>期間：1年 or 3年<br>支払い方法：前払い、一部前払い、前払いなし<br>スタンダード or コンバーティブル：後者は期間中にインスタンスタイプの変更可能 |
| スポットインスタンス | キャパシティの利用状況に応じてコストが動的に変換<br>短時間の作業向き |
| Dedicated Hosts | EC2が起動するホストを専有。セキュリティ/ガバナンス要件、ライセンス要件等を満たす目的で使用。インスタンスではなくホストに対しての従量課金 |
| ハードウェア専有インスタンス | アカウント専用のハードウェアでEC2を実行。インスタンスに対しての従量課金だが専有追加料金が必要 |
| Savings Plans | 1年または3年でより柔軟にコスト節約。FargateやLambdaも同様にCompute Savings Plansがある |

### 5-2 ELB
ELB: Elastic Load Balancing
* 冗長構成のEC2に対するリクエストを単一のエンドポイントで受け付けるためのサービス
* EC2インスタンスの可用性を高めることができる

#### ELBの特徴
* ロードバランサータイプ
* ヘルスチェック
* インターネット向け/内部向け
* 高可用性のマネージドサービス
* クロスゾーン負荷分散

#### ロードバランサータイプ

| タイプ | 機能 |
|--|--|
| Application Load Balancer | HTTPまたはHTTPSのリクエストを負荷分散<br>Webアプリケーションに対して高度な機能を提供 |
| Network Load Balancer | HTTP,HTTPS以外のTCPプロトコルに対して適用<br>Static IPアドレスを使用可<br>数百万リクエスト/秒を処理可能 |
| Classic Load Balancer | 以前のタイプのロードバランサー<br>現状は新規でこれを利用することはない |

#### ヘルスチェック
* 指定されたURLまたはpingに対するハートビート
* エラーが継続するとUnhealthyとしリクエストを送信する対象から除外

#### インターネット向け/内部向け
* インターネット向けだけでなく内部向けに作ることも可能
* ELBのDNSをパブリックIPアドレスに紐づけるか、プライベートIPアドレスに紐づけるかで変えられる
* ELBに対してのトラフィックは、EC2と同様にセキュリティグループで制御可能

#### 高可用のマネージドサービス
* ELBそのものは単一障害点（SPOF）とはならない
* AWSが管理する高可用性なサービスのため

#### クロスゾーン負荷分散
* その名の通り、AZを超えての負荷分散
* Application Load Balancerでは常に有効、Network Load Balancerでは有効/無効を選択できる
* 有効にしていると、すべてのターゲットインスタンスに対してリクエストが送信される→全ターゲットインスタンスで負荷を均等にする

### 5-3 Auto Scaling
* EC2インスタンスを条件に応じて自動的に追加/削減できる
* Auto Scalingのメリットは、高可用性、耐障害性、コスト効率化
* Auto Scalingそのものは無料で利用可能

#### 垂直スケーリングと水平スケーリング

| 項目 | 垂直スケーリング | 水平スケーリング |
|--|--|--|
| スケール方法 | サイズを変更 | インスタンス数を変更 |
| 影響 | あり（検証や停止が必要） | なし（事前に設計） |
| 上限 | インスタンスの最大サイズ | なし |

水平スケーリングの方がすケースしやすく、「スケーラビリティを確保する
」というベストプラクティスを簡単に実現できる。

#### Auto Scalingの設定
* 何を：起動設定 (Launch Template)
  * AMIを指定するなど、どれをどのような形で起動するか
* どこで：Auto Scalingグループ
  * EC2インスタンスを起動するゾーン/サブネットを設定
* いつ：Auto Scalingポリシー
  * 起動/終了するタイミングや条件を設定
    * ターゲットポリシー：CPU率等にもとづき設定
    * シンプルポリシー：CloudWatchのアラームにもとづき設定
    * ステップポリシー：複数フェーズでの追加/削除を設定

#### アプリケーションデプロイの自動化
* AMIからのブートストラップ
  * ユーザーデータ：インスタンス起動直後の実行スクリプト
  * メタデータ：AWSから取得するインスタンス固有の情報
    * `curl --silent http://169.254.169.254/latest/meta-data/`

#### ELBとAuto Scalingを使用したスケーラブルなWebアプリケーション
1. ALBの作成
    * セキュリティグループ、ルーティング等の設定
    * SSLターミネーション
      * ALBのリスナーをHTTPSにしてSSL証明書の設定を行い、ターゲットに対してはHTTPでアクセスする構成を作ることもできる
      * ユーザーがアクセスするドメインに対しての証明書を管理するのみいなり、ターゲットとなっているインスタンス１つ１つに対して証明書を管理する必要はない
2. 起動設定の作成
    * AMI、インスタンスタイプ、ユーザーデータ、セキュリティグループ等の設定
3. Auto Scalingグループの作成
    * AMI、ヘルスチェック、Auto Scalingポリシーの作成
4. 動作確認

> ELB, Auto Scaling, CloudWatchの3つのサービスで
> 自律的でスケーラブルなアプリケーションを構築できる
    


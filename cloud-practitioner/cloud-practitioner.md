# クラウドプラクティショナー学習まとめ

## 1. 試験内容
### 試験の対象分野

| 分野 | 試験の割合 |
|--|--|
| クラウドの概念 | 26% |
| セキュリティとコンプライアンス | 25% |
| 請求と料金 | 16% |
| テクノロジー | 33% |

試験の内容をマインドマップで整理
![](assets/exam-coverage.svg)

### 試験の詳細
* 問題数: **65問**
* 試験時間: **90分**
* 最低合格スコア: **70%**
* 試験には、多肢選択式と複数解答の2種類の問題がある
  * 多肢選択式の問題では、1つの正しい選択肢と3つの誤った選択肢 (不正解) が提示される
  * 複数解答の問題では、選択肢が5つ以上提示され、そのうち**2つ以上が正解**

## 2. クラウドの概念
### クラウドコンピューティングとは
3つのデプロイモデル

1. クラウドベースデプロイ
    * リソースをクラウドに展開
2. オンプレミスデプロイ
    * リソースをオンプレミスに展開
    * プライベートクラウドデプロイとも呼ばれる
3. ハイブリッドデプロイ
    * クラウドのリソースをオンプレミスのインフラに接続
    * レガシーアプリケーションをオンプレミスで運用しつつ、データ分析サービスをクラウドで実行する等

### クラウドコンピューティングの6つの利点
https://docs.aws.amazon.com/whitepapers/latest/aws-overview/six-advantages-of-cloud-computing.html

1. Trade capital expense for variable expense
    * 先行支出（設備投資費等の固定費）を変動支出に切り替える
2. Stop spending money running and maintaining data centers
    * データセンターやインフラ導入コスト、それらの運用保守への投資不要
3. Stop guessing capacity
    * キャパシティの予測が不要
    * 需要に応じて（**オンデマンド**に）キャパシティを追加/削減（**スケールアウト/スケールイン**）すればよい
4. Benefit from massive economies of scale
    * 数十万のユーザーによる圧倒的に高いスケールメリット
    * AWSにサービスを集約することで自社で構築するよりも変動コストを抑制可能
5. Increase speed and agility
    * スピードと俊敏性の向上
    * 新しいリソースの取得が数分で行える分、実験やイノベーションにかける時間を増やせる
6. Go global in minutes
    * AWSのグローバルインフラクトラクチャを利用することで、世界中に低レイテンシーでアプリケーションを展開

### Well-Architectedフレームワーク
https://aws.amazon.com/jp/architecture/well-architected/

* 信頼性、安全性、効率が高く、コスト効率に優れたシステムを設計し、AWS クラウドで運用する方法を理解するのに役立つ
* ベストプラクティスに照らしてアーキテクチャを評価し、原則を設計し、改善すべき分野を特定する一貫した方法を提供
* 自分自身で確認するAWS Well-Architected Toolもある

#### 5つの柱
1. 運用上の優秀性 (Operation Excellence) 
    * ビジネス価値実現のための継続的な改善プロセス構築
    * 例えば、デプロイパイプラインの構築等
2. 安全性 (Security) 
    * ビジネス価値を提供しながら、情報・システム・資産を保護する能力
    * 具体的には、データの整合性・暗号化等の機能
3. 信頼性 (Reliability) 
    * システムの早期の自動障害復旧・高可用性等、一貫したワークロードの実現
    * 自動スケーリングや自動プロビジョニング
4. パフォーマンス効率 (Performance Efficiency) 
    * システム要件を満たす効率的なコンピューティングリソース配分・維持
    * 具体的には、サーバレスアーキテクチャ、グローバルなデプロイ
5. コスト最適化 (Cost Optimization) 
    * 最も安価にシステムを実行してビジネス価値を実現
    * 具体的には、マネージドサービス適用によるコスト効率化

#### 11のベストプラクティス
5つの柱の具体例は **ベストプラクティス**として公開されており、
AWSホワイトペーパー等により確認・学習が可能

| | 項目 | 内容 | 関連サービス |
|--|--|--|--|
| 1 | スケーラビリティの確保 | 需要の変化に対応できるアーキテクチャを設計 | Auto Scaling、CloudWatch、RDS、DynamoDB |
| 2 | 環境の自動化 | システムの安定性・整合性及び組織の効率性を改善するため主要プロセスを自動化する | CloudFormation、Codeシリーズ、ElasticBeanstalk、OpsWorks、ECS |
| 3 | 使い捨てリソースの使用 | サーバーなどのコンポーネントを一時的なリソースとして利用・設計 | EC2、Auto Scaling |
| 4 | コンポーネントの疎結合 | コンポーネント間の相互依存を減らした構成とし、１つのコンポーネント変更や障害の影響を削減 | ELB、SNS、SQS |
| 5 | サーバレス | マネージド型サービスとサーバレスアーキテクチャにより、効率的な設計と運用を実現 | マネージド型サービス全般 |
| 6 | 最適なデータベース選択 | ワークロードに応じた最適なデータベース技術を利用 | RDS、Aurora、Redshift、DynamoDB、ElasticSearch |
| 7 | 増大するデータ量対応 | IoT/ビッグデータなどで絶えず増加するデータの保持を効率的に実施する | S3、Glacier、Kinesis |
| 8 | 単一障害点(SPOF)の排除 | AWSのサービスの多くは高可用が保証されているものが多いが、そうでないものはELBやマルチAZによる高可用設計が必要 | |
| 9 | コスト最適化 | リソースが適切なサイズから必要に応じたスケールアウト・スケールインの実施と最適な料金プランの選択する | EC2購入プラン、Auto Scaling、Trusted Advisor |
| 10 | キャッシュの利用 | 繰り返し取り出すデータやコンテンツについてはキャッシュを利用する構成とする | CloudFront、ElastiCache |
| 11 | セキュリティの確保 | 全てのレイヤー・境界・リソース内/間においてセキュリティを実装する | ほぼすべてのリソース |

5つの柱と11のベストプラクティスの関係性
![](assets/well-architected-framework.svg)

## 3. セキュリティとコンプライアンス
### 責任共有モデル
![](assets/shared-responsibility-model.png)

* AWSはユーザー（顧客）の環境を「相互に関連づけられ構築されているパーツの集合」として扱う
* 責任共有モデル：AWSはユーザーの環境の一部に責任を持ち、その他の部分はユーザーが責任を持つ

#### 責任範囲の考え方
| 項目 | 責任範囲 | 内容 |
|--|--|--|
| 物理的なセキュリティ | AWS | 1. 環境レイヤー：自然災害等の環境リスクの軽減<br>2. 物理的な境界防御レイヤー：保安要員、防御壁、監視カメラ等の物理設備の設置<br>3. 物理的なインフラレイヤー：発電設備、冷暖房設備、消化設備等の設置<br>4. データレイヤー：アクセス制限、脅威検出
| ハイパーバイザーのセキュリティ | AWS | VMエスケープやVMホッピング等のハイパーバイザーをターゲットにした攻撃<br>準仮想化(PV)インスタンスについても、最新のAMIや更新パッケージを提供 |
| 管理プレーン | ユーザー | IDとパスワード<br>キーペア<br>アクセスキー<br>IAM等のアクセス制御と権限管理 |
| 非マネージドサービスのセキュリティ | ユーザー | IaaS（VPC,EC2）等はユーザーが必要なセキュリティ設定と管理タスクを実施 [※1]<br>そこに配置するデータやコンテンツの管理もユーザーの責任 |
| マネージドサービスのセキュリティ | AWS | PaSSやSaaSに該当するサービスのセキュリティ対応 |

* [※1] EC2インスタンスのペネトレーションテスト等はユーザーがAWSからの許可なし行ってよい

### ユーザーアクセス
#### ルートユーザー
* サインアップ時に作成したアカウント
* AWSアカウントの全ての権限を持っている
* 日常的な作業にはこれを使わずIAMユーザーを作成して利用する

#### IAM
* IAMアイデンティティ
  * IAMユーザー
  * IAMロール
  * IAMグループ
* IAMポリシー
  * IAMアイデンティティに割り当てる権限を記述したJSONドキュメント
    * `Effect`: 許可/禁止を記述
    * `Action`: 操作のコマンドを記述
    * `Resource`: 操作の対象リソースを記述
* アクセスキー
  * IAMユーザーに対する長期的な認証情報。アクセスキーID・シークレットアクセスキーで構成
  * このキー認証を通すことで、IAMユーザーの権限でAWSリソースに対する操作を実行可能
* IDフェデレーション
  * 外部で管理されたIDで認証してAWSサービスの使用許可を制御
* MFA（多要素認証）
  * ID、パスワードに加えて、専用デバイス/仮想デバイスに表示されるランダムなコードによる認証方式

### AWS Organizations
#### 複数アカウントを一元管理
その企業が複数のアカウントを持っている場合、AWS Organizationsを使用すると、それらのアカウント群をー元的に管理することができる

#### 組織単位（OU）
![](assets/organization-unit.png)

管理しているアカウントのうちの複数を組織単位（OU：Organization Unit）にグループ化できる

#### サービスコントロールポリシー（SCP）
OUまたは個別アカウントに指定するポリシーで、OU／アカウントで実行できるサービスやアクションを制限できる

### コンプライアンス
#### AWS Artifact
* https://aws.amazon.com/jp/artifact/
* セキュリティおよびコンプライアンスレポートと特定のオンライン契約にオンデマンドにアクセスできる

| サービス | 内容 |
|--|--|
| AWS Artifact Reports | サードパーティーの監査人が世界、地域、業界の指定された基準や規制を遵守しテストおよび確認したコンプライアンスレポートを提供 |
| AWS Artifact Agreements | ユーザーのアカウントとAWSとの契約の確認、受諾、管理が行えるサービス<br>扱える契約の種類は多岐にわたり、医療保険の相互運用性と説明責任に関する法令（HIPAA）など、特定の規制の対象となる顧客のニーズにも対応 |

#### カスタマーコンプライアンスセンター
* https://aws.amazon.com/jp/compliance/customer-center/
* AWSのコンプライアンス、統制、監査の詳細を確認するためのリソースを提供

### クラッキング対策
#### セキュリティグループ
* リソースへの適切なリクエストトラフィックのみを許可するサービス
* セキュリティグループはインスタンスレベルではなくネットワークレベルで動作する
* UDPフラッドやUDPリフレクションのような低レベルネットワークの攻撃に対して、ネットワーク（AWSインフラ）レベルで対処できるため、ユーザーのアプリケーションが攻撃に対して直接的に被害を受けず極めて有効に働く

#### ELB（Elastic Load Balancer）
* リソースに対するリクエストを単一のエンドポイントで受け付けるためのサービス
* AWSのリージョン単位で機能するため、SlowlorisのようにHTTPトラフィックのリクエストを遅延・飽和させるような攻撃について、攻撃者はリージョンレベルで飽和させる必要があるため極めてコストがかかることから、これらの攻撃に対して有効に働く

#### AWS Shield
DDoS攻撃からアプリケーションを保護するサービス

| サービス | 有償/無償 | 内容 |
|--|--|--|
| AWS Shield Standard | 無償 | 最も一般的で頻度の高いタイプのDDoS攻撃からAWSリソースを保護 |
| AWS Shield Advanced | 有償 | ・詳細な攻撃診断と、高度なDDoS攻撃の検出および緩和機能を持つ<br>・CloudFront、Route 53、Elastic Load Balancing などの他のサービスと統合されている<br>・複雑なDDoS攻撃を緩和するカスタムルールを作成して、AWS WAFと統合することができる。また、WAFサービスが無制限に利用可能になる<br>・DDoS Response Team（DRT）のフォレンジックや分析サポートを24時間365日受けることができる |

#### AWS WAF（Web Application Firewall）
* CloudFrontやALBと連動してウェブアプリケーションに入ってくるネットワークリクエストをモニタリングするウェブアプリケーションファイアウォール
* WAFの定義（ウェブACL）はユーザー自身で行う必要があるが、SQLインジェクションやXSSのような一般的な攻撃をブロックするカスタムルールが用意されており、特定のアプリケーションのための独自ルールを作成することも可能

### データ暗号化
#### AWS KMS（Key Management System）
* AWSリソースに対して暗号化キーによる暗号化オペレーションを実行できるサービス
* 暗号化キーそのものはAWS管理のサーバで管理しそれを利用
* CloudTrailと統合されており、すべての暗号化キーの使用履歴ログを確認可能

#### CloudHSM
* AWSが提供するクラウドベースのハードウェアセキュリティモジュール（HSM）
* CloudHSMクラスタはユーザー専用（KMSの場合は共有サーバ）のため、VPC内にクラスタを作成する必要がある
* PKCS#11、Java Cyrptography Extensions（JCE）、Microsoft CryptNG（CNG）といったグローバル標準の暗号化形式に対応
* 暗号化キーを他のHSMソリューションに移行することも可能
* KMSよりより厳しいコンプライアンス基準に対応できると思われる

### 評価/分析
#### Inspector
* アプリケーションのセキュリティとコンプライアンスを向上させるために、脆弱性診断等のセキュリティ評価を自動で行うサービス
* PCI DSSのようなルールパッケージを利用してスケジュール設定により自動でチェック。例えばEC2インスタンスの脆弱性やセキュリティのベストプラクティスの逸脱を検出
* 生成されたコンプライアンスレポートはAWS Artifactから取得可能

#### GuardDirty
* AWSインフラストラクチャとリソースのインテリジェントな脅威検出を提供するサービス
* AWS環境内におけるネットワークとアカウントのアクティビティを継続的にモニタリングし脅威を特定
* また、AWS Lambda関数に対して、GuardDutyのセキュリティ調査結果に応じて自動修復を実行することもできる（自動修復対象のリソースはLambdaの他もあるかも）

#### AWS不正対策チーム（Trust & Safety Team）
* https://aws.amazon.com/jp/premiumsupport/knowledge-center/report-aws-abuse/
* AWSリソースが不正使用されている、または違法な目的で使用されている疑いがある場合にサポートを提供してくれる
* 不正対策チームの処理例は以下の通り

| 項目 | 内容 |
|--|--|
| スパム | AWS所有のIPアドレスから不要なメールが届く、またはAWSリソースがスパムウェブサイトやフォーラムに使用されている |
| ポートスキャニング | ログに、1つ以上のAWS所有のIPアドレスがサーバー上の複数のポートにパケットを送信していることが示されており、セキュリティで保護されていないポートを検出しようとしていると考えられる |
| サービス拒否攻撃 (DOS) | ログに、1つ以上のAWS所有のIPアドレスがリソースのポートをパケットで溢れさせるために使用されていることが示されている |
| 侵入の試み | ログに、1つ以上のAWS所有のIPアドレスがリソースへのログイン試行に使用されていることが示されている |
| 不快なコンテンツや<br>著作権で保護された<br>コンテンツのホスティング | AWSリソースが著作権者の同意なしに、違法コンテンツをホストまたは配布している |
| マルウェア配信 | インストール先のコンピュータやマシンに不正アクセスしたり危害を加えるために意図的に作成されたソフトウェアを配布するために、AWSリソースが使用されている証拠がある |

## 4. 請求と料金
### 料金
#### 無料利用枠
* AWS無料利用枠を使用すると、一定期間料金が発生することを心配せずに、特定のサービスの使用を開始できる
* 用意されているオファーは以下の3種

| 利用枠 | 開始 | 対象サービス | 内容 |
|--|--|--|--|
| 無期限無料 | 無期限 | Lambda | 毎月100万件の無料リクエストと最大320万秒のコンピューティング時間が無料 |
| | | DynamoDB | 毎月25GBのストレージが無料 |
| 12か月間無料 | サインアップした日から | EC2 | 特定のインスタンスタイプのEC2インスタンス |
| | | S3 | 特定量のS3標準ストレージ |
| | | CloudFront | 特定量のデータ送信 |
| トライアル | そのサービスを有効化した日から | Inspector | 90日間の無料トライアル |
| | | Lightsail | 30日間750時間までの無料トライアル |

#### 料金体系の仕組み
幅広いクラウドコンピューティングサービスを従量課金性で提供

* 使用分についてのみ課金される
  * 各サービスにおいて実際に使ったリソースの量に応じて料金を支払う
  * 長期の契約や複雑なライセンスは不要
* 予約して支払いを削減する
  * 一部のサービスでは、オンデマンドインスタンスと比べて大幅な割引を得られる予約オプション（Savings Plans）がある [※1]
* 使用料が増えるほど、ボリュームディスカウントにより支払いが少なくなる
  * 一部のサービスでは段階制料金が用意されており、使用量が増えるほど単位あたりのコストが低くなる
  * 例えばS3はストレージ容量の使用量が増えるほど、1GBあたりに支払う料金が少なくなる

> * [※1] EC2,Lambda,Fargateなど、1年または3年の長期利用に対して大幅なディスカウントがされる
>   * リザーブドインスタンス（RI)とは別の概念のため併用は可能（併用がその手間に見合うかは別問題でありそう）
>   * https://qiita.com/hayao_k/items/650a2131a96c8f20cb97

#### 料金計算ツール
* AWS料金計算ツール
  * https://calculator.aws/#/
  * AWSのサービスを確認し、AWSユースケースのコスト見積もりを作成できる
* AWS簡易見積もりサービス
  * 事前に請求見込み金額を計算可能
  * **AWS料金計算ツールに置き換えられるため今後は使用されない**
* AWS TCO計算ツール
  * TCO: Total Cost of Ownership
  * AWSへの移行・導入を検討している際に、オンプレミス構築とのコスト比較をレポートしてくれる

### 請求
#### 請求とコスト管理ダッシュボード
* 月別の請求額や内訳を確認できる
* 今月途中の利用や来月の請求額の予測を知ることができる
* 無料利用枠の使用状況を確認できる
* AWS Budgetsで予算を作成する（後述）
* Savings Plansの購入・管理を行う
* AWSのコストと使用状況レポート（CUR：Cost and Usage Report）を発行できる

#### コンソリデーティッドビリング（一括請求）
* AWS Organizationsのオプションの１つで、組織内のすべてのアカウントの請求書を１つにまとめることができる
* １つにまとめることでボリュームディスカウント（合計使用量による割引）を受けれたり、Savings Plansやリザーブドインスタンスを組織内のアカウントで共有することができる

#### AWS Budgets
![](assets/budgets.png)

* 予算を作成してサービスの使用量、コスト、インスタンスのリザーブを計画できる
* 毎日3回更新され、使用量が予算の量または無料利用枠の制限にどれくらい近づいているかを正確に確認できる
* 設定予算を超えた時にor超えると予想される場合に送信されるカスタムアラートを設定できる

#### AWS Cost Explorer
![](assets/cost-explorer.png)

* 時間の経過に伴うAWSのコストと使用量を可視化して把握し、管理できるツール
* これまでのAWSのコストを分析することで、今後のコストの予算の組み立て方について十分な情報にもとづく意思決定が行える

### AWSサポートプラン

| プラン | 料金 | 内容　|
|--|--|--|
| ベーシック | 無料 |・Trusted Advisorの一部を利用できる<br>・AWS Personal Health Dashboardを使用できる
| デベロッパー | 29USD<br>使用料の3%<br>の大きい方 | ・Trusted Advisorの一部を利用できる<br>・ベストプラクティスのガイダンス<br>・クライアント側の診断ツール？<br>・基盤となるアーキテクチャのサポート（9:00〜18:00） |
| ビジネス | 100USD<br>使用料に応じた計算式<br>の大きい方 | ・Trusted Advisorの全機能を利用できる<br>・技術サポート（24h可）・サードパーティソフトウェアの限定的なサポート |
| エンタープライズ | 15,000USD<br>使用料に応じた計算式<br>の大きい方 | ・Trusted Advisorの全機能を利用できる<br>・技術サポート（24h可）<br>**・テクニカルアカウントマネージャー (TAM)**<br>・ホワイトグローブケースルーティング（問題をあげた時にAWSの各部署が連携して優先対応）<br>・Infrastructure Event Management |

> 実ビジネスで利用する場合は、技術サポートを24時間受けれるビジネスorエンタープライズがおすすめらしい

#### テクニカルアカウントマネージャー（TAM）
* AWSのすべてのサービスに関する専門的な知識を提供。複数のサービスを効率的に使用するソリューションを設計・提案
* エンタープライズサポートプランに加入している場合は、TAMがAWSの主要な窓口となる

### AWS Marketplace
* 独立系ソフトウェアベンダーから提供された多くのソフトウェアからなるデジタルカタログ
* AWSで実行できるソフトウェアのトライアルや購入が可能

## 5. テクノロジー
### グローバルインフラクトラクチャ

### プロビジョニングとデプロイ

### ネットワーク

### コンピューティング

### ストレージ

### データベース

### モニタリング/分析

### AWSへの移行






